<div id="oosSimilarTopSection" class="oosSimilarTopSection" *ngIf="productOutOfStock">
    <h2 *ngIf="productService.oosSimilarProductsData.similarData.length > 1">Consider These Available Items</h2>
    <div class="horizontal-scroll-container consider-these-products" id="horizontal-scroll-container" (scroll)="onScrollOOOSimilar($event)">
        <ng-container *ngIf="productService.oosSimilarProductsData.similarData.length > 1">
            <product-card-horizontal-grid-view [hideAd]="true" *ngFor="let card of similarForOOSContainer; let i = index;" [cardFeaturesConfig]='oosSimilarcardFeaturesConfig' [isOosSimilarCard]="true" [moduleUsedIn]="'PRODUCT_SIMILAR_OUT_OF_STOCK_TOP'" [product]="productService.oosSimilarProductsData.similarData[i]">
            </product-card-horizontal-grid-view>
        </ng-container>
        <ng-container *ngIf="similarForOOSLoaded">
            <product-card-skeleton *ngFor="let skeleton of similarForOOSContainer" class="skeleton-pd-card-container skeleton-card-view">
            </product-card-skeleton>
        </ng-container>
    </div>
</div>

<div class="pdp-container display-block" [ngClass]="{'pdp-container-remove': productOutOfStock}" *ngIf="!productNotFound">

    <div class="prod-carsl" addClass [class.hasOneImage]="productAllImages?.length === 1" [ngClass]="[carouselInitialized ? '' : 'before-init']">
        <div class="fixed-strip">
            <span class="fixed_ico" (click)="loadProductShare()"><i class="icon-product_share"></i></span>
            <span class="fixed_ico wishlist" [class.active]="isPurcahseListProduct" (click)="addToPurchaseList()">
                <i [ngClass]="isPurcahseListProduct ? 'icon-wishlist1-active' : 'icon-wishlist1-inactive'"></i>
            </span>
            <span *ngIf="productOutOfStock  && productService.oosSimilarProductsData.similarData.length > 2" (click)="scrollToId(!productOutOfStock ? 'similarProducts' : 'similarProductsOos')" class="fixed_ico fixed_ico-img"><img src="{{imagePathAsset}}assets/img/similar-ico.svg">
            </span>
        </div>
        <ng-container #productCrousel></ng-container>
        <div class="prod-carsl-pseudo" (click)="openPopUpcrousel(0)" swipe (next)="onRotateNext()" #productCrouselPseudo (previous)="onRotatePrevious()">
            <div class="oos-tag" *ngIf="productOutOfStock">
                <span>
                    AVAILABLE ON REQUEST
                </span>
            </div>
            <div class="img-block-pseudo">
                <div class="inner-block-pseudo">
                    <div class="pinch-zoom element-pseudo" (click)="sendProductImageClickTracking()" style="transform-origin: 0% 0%;">
                        <img *ngIf="!isProductCrouselLoaded" src="{{productAllImages[0]['large'] }}" height="330" width="330" alt="{{productName}}">
                        <img *ngIf="isProductCrouselLoaded" src="{{imagePathAsset}}assets/img/loader_new.gif" class="loader-image" />
                    </div>
                </div>
                <ul class="pager">
                    <ng-container *ngIf="!isProductCrouselLoaded && !productCrouselInstance && iOptions?.pager && productAllImages?.length>1">
                        <ng-container *ngFor="let item of productAllImages;let i=index">
                            <li *ngIf="item['contentType'] == 'IMAGE'" class="pager_dot" (click)="loadProductCrousel(i)" [ngClass]="{'active': ( i==0 && !isProductCrouselLoaded ) || ( i==1 && isProductCrouselLoaded) }">
                            </li>
                            <li *ngIf="item['contentType'] == 'YOUTUBE_VIDEO'" (click)="loadProductCrousel(i)" class="pager_icon_dot">
                                <em class="icon-youtube"></em>
                            </li>
                        </ng-container>
                    </ng-container>
                </ul>
            </div>
        </div>

        <!-- TODO: check how this section is used in PQA -->
        <ng-container *ngIf="productTags != undefined && !this.productOutOfStock">
            <div class="image_tag">
                <div class="tag_container" *ngFor="let tag of productTags | arrayFilterPipe : 'type': 'image': 'object' | slice:0:1;let i = index;">
                    <img src="{{tag.imageUrl}}">
                </div>
            </div>
        </ng-container>
    </div>


    <product-description (checkBulkPriceMode)="checkBulkPriceMode()" [isBulkPricesProduct]="isBulkPricesProduct" [productBulkPrices]="productBulkPrices" [selectedProductBulkPrice]="selectedProductBulkPrice" [qunatityFormControl]="qunatityFormControl" [productPrice]="productPrice"
        [productName]="productName" [productTags]="productTags" [refinedProdTags]="refinedProdTags" [productMrp]="productMrp" [priceWithoutTax]="priceWithoutTax" [productDiscount]="productDiscount" [bulkPriceWithoutTax]="bulkPriceWithoutTax" [bulkDiscount]="bulkDiscount"
        [taxPercentage]="taxPercentage" [bulkSellingPrice]="bulkSellingPrice" [productOutOfStock]="productOutOfStock" [productMinimmumQuantity]="productMinimmumQuantity" [priceQuantityCountry]="priceQuantityCountry" [starsCount]="starsCount" [rawReviewsData]="rawReviewsData"
        [rawProductCountMessage]="rawProductCountMessage">
    </product-description>

    

    <!-- Product bulk quantity section starts -->
    <app-product-quantity [isCommonProduct]="isCommonProduct" [productFilterAttributesList]="productFilterAttributesList" (updateAttr)="updateAttr($event)" (removeOosSimilarSection)="removeOosSimilarSection()"></app-product-quantity>

    <!-- Product bulk quantity section ends -->

    <!-- Product quantity action section starts -->

    <!-- TO DO - create component - product-bulk-qauntity  STARTS
    SCSS - @import '../../scss/bulk-quantity'; -->
    <product-bulk-quantity (checkBulkPriceMode$)="checkBulkPriceMode()" [rawProductData]="rawProductData" [productOutOfStock]="productOutOfStock" [isCommonProduct]="isCommonProduct" [priceQuantityCountry]="priceQuantityCountry" [productBulkPrices]="productBulkPrices"
        [cartQunatityForProduct]="cartQunatityForProduct" [qunatityFormControl]="qunatityFormControl">
    </product-bulk-quantity>
    <!-- TO DO - create component - product-bulk-qauntity  END
    SCSS - @import '../../scss/bulk-quantity'; -->

    <!-- Product quantity action section ends -->
    <div *ngIf="!productOutOfStock" class="deals-block bg-white" observeVisibility [debounceTime]="300" (visible)="onVisibleOffer($event)">
        <ng-container #offerSection></ng-container>
    </div>
    <div observeVisibility [debounceTime]="100" (visible)="onVisiblePincodeSection($event)" *ngIf="!productOutOfStock">
        <ng-container #pincodeForm></ng-container>
    </div>
    <!-- other sections starts -->

    <div>
        <!-- RFQ section ends -->

        <product-benefits [isProductReturnAble]="isProductReturnAble" [productOutOfStock]="productOutOfStock" (navigateToFAQ$)="navigateToFAQ()"  ></product-benefits>


        <app-product-feature-details (showYTVideo$)="showYTVideo1($event)" (handleProductInfoPopup$)="handleProductInfoPopup1($event)" [productKeyFeatures]="productKeyFeatures" [productAttributes]="productAttributes" [productDescripton]="productDescripton" [productCategoryDetails]="productCategoryDetails"
            [productBrandDetails]="productBrandDetails" [productName]="productName" [productVideos]="productVideos" [productDocumentInfo]="productDocumentInfo" [productBrandCategoryUrl]="productBrandCategoryUrl"></app-product-feature-details>


        <section *ngIf="productOutOfStock && !isRFQSuccessfull && !isAskQuestionPopupOpen" observeVisibility [debounceTime]="100" (visible)="onVisibleProductRFQ($event)">
            <ng-container #productRFQ></ng-container>
        </section>

        <section class="card" [ngClass]="{'fbtSection': fbtComponentInstance}" observeVisibility [debounceTime]="100" (visible)="getFbtIntance($event)">
            <ng-container #fbt></ng-container>
        </section>

        <app-product-review [productName]="productName" [reviewLength]="reviewLength" [overallRating]="overallRating" [rawReviewsData]="rawReviewsData" (writeReview)="writeReview($event)" (reviewRatingPopup)="handleReviewRatingPopup($event)" (postHelpful)="handlePostHelpful($event)"></app-product-review>

        <app-product-qa [questionAnswerList]="questionAnswerList" (handleFaqListPopup)="handleFaqListPopup()" (askQuestion)="askQuestion()">
        </app-product-qa>

        <app-product-get-quote (raiseRFQQuote$)="raiseRFQQuote()" [rfqQuoteRaised]="rfqQuoteRaised" [productOutOfStock]="productOutOfStock" [productMrp]="productMrp" [productCategoryDetails]="productCategoryDetails" [productName]="productName" [productAllImages]="productAllImages"></app-product-get-quote>

        <section id="similarProducts" observeVisibility [debounceTime]="100" (visible)="onVisibleSimilar($event)">
            <ng-container #similarProduct></ng-container>
        </section>

        <app-product-more-widget [taxons]="taxons" [baseDomain]="baseDomain" [orderTracking]="orderTracking" [productBrandDetails]="productBrandDetails" [productCategoryDetails]="productCategoryDetails" [productBrandCategoryUrl]="productBrandCategoryUrl">
        </app-product-more-widget>

        <section id="sponseredProducts" observeVisibility [debounceTime]="100" (visible)="onVisibleSponsered($event)">
            <ng-container #sponseredProducts></ng-container>
        </section>


        <section id="productAccordianSection" observeVisibility [debounceTime]="100" (visible)="onVisibleProductAccordians($event)">
            <ng-container #pdpAccordian></ng-container>
        </section>

        <ng-container *ngIf="breadcrumbData && breadcrumbData.length > 0 && productOutOfStock">
            <breadcrumb-nav [breadcrumb]="breadcrumbData" [analytics]="breadCrumbAnalytics"></breadcrumb-nav>
        </ng-container>

        <section *ngIf="productOutOfStock" id="similarProductsOos" observeVisibility [debounceTime]="100" (visible)="onVisibleSimilarOOS($event)">
            <ng-container #similarProductOOS></ng-container>
        </section>

        <past-orders *ngIf="isBrowser && isLoggedIn" [outOfStock]="productOutOfStock" [analytics]="pastOrderAnalytics">
        </past-orders>

        <div class="pwa-row app-promo" observeVisibility [debounceTime]="300" (visible)="onVisibleAppPromo($event)">
            <div class="pwa-col-12">
                <ng-container #appPromo></ng-container>
            </div>
        </div>

        <section observeVisibility class="pwa-col-12" [debounceTime]="100" [ngClass]="{'recent_section': !recentProductsInstance}" (visible)="onVisibleRecentProduct($event)">
            <ng-container #recentProducts></ng-container>
            <div class="loader_container" *ngIf="!recentProductsInstance">
                <div class="loader"></div>
            </div>
        </section>

        <div [class.mb-60]="productOutOfStock && productService.oosSimilarProductsData.similarData.length < 3"></div>
        <ng-container *ngIf="breadcrumbData && breadcrumbData.length > 0 && !productOutOfStock">
            <breadcrumb-nav [breadcrumb]="breadcrumbData" [analytics]="breadCrumbAnalytics"></breadcrumb-nav>
        </ng-container>
    </div>

    
</div>


<!-- CTA Fixed position -->
<floating-button-container *ngIf="!productOutOfStock">
    <floating-button [label]="'ADD TO CART'" [type]="'RED'" (onClick)="showFBT()"></floating-button>
    <floating-button [label]="'BUY NOW'" [type]="'RED'" (onClick)="addToCart(true)"></floating-button>
</floating-button-container>

<floating-button-container *ngIf="productOutOfStock && !showScrollToTopButton && productService.oosSimilarProductsData.similarData.length > 2" >
    <floating-button [label]="'VIEW IN-STOCK'" [type]="'RED'" (onClick)="scrollToId(!productOutOfStock ? 'similarProducts' : 'similarProductsOos')"></floating-button>
    <floating-button [label]="'GET BEST PRICE'" [type]="'RED'" (onClick)="getBestPrice($event)"></floating-button>
</floating-button-container>

<floating-button-container *ngIf="productOutOfStock && !showScrollToTopButton  && (!productService.oosSimilarProductsData.similarData  || productService.oosSimilarProductsData.similarData.length <= 2 )">
    <floating-button [label]="'GET BEST PRICE'" [type]="'RED'" (onClick)="getBestPrice($event)"></floating-button>
</floating-button-container>
<!-- CTA Fixed position -->

<app-page-not-delivered *ngIf="productNotFound"></app-page-not-delivered>

// TODO: product-rfq-thanks-popup should be lazy loaded
<product-rfq-thanks-popup (closeRFQAlert$)="closeRFQAlert()" (scrollToId$)="scrollToId($event)" (navigateToCategory$)="navigateToCategory()" [rfqTotalValue]="rfqTotalValue" [hasGstin]="hasGstin" [getWhatsText]="getWhatsText" [similarProducts]="similarProducts"
    [productOutOfStock]="productOutOfStock" [isRFQSuccessfull]="isRFQSuccessfull" [imagePathAsset]="imagePathAsset">
</product-rfq-thanks-popup>

// TODO: whatsapp-toast should be lazy loaded
<whatsapp-toast (click)="sendTrackingData()" [customText]="getWhatsText"></whatsapp-toast>

<ng-container *ngIf="showScrollToTopButton">
    <div class="scroll-arrow-pdp" (click)="scrollToTop()">
        <i class="icon-up"></i>
    </div>
</ng-container>


<ng-container *ngIf="!productOutOfStock" #productRFQ></ng-container>
<ng-container #rfqForm></ng-container>
<ng-container #offerPopup></ng-container>
<ng-container #offerComparePopup></ng-container>
<ng-container #writeReviewPopup></ng-container>
<ng-container #alertBox></ng-container>
<ng-container #globalToast></ng-container>
<ng-container #emiPlansPopup></ng-container>
<ng-container #reviewRatingPopup></ng-container>
<ng-container #questionAnswersPopup></ng-container>
<ng-container #productInfoPopup></ng-container>
<ng-container #faqListPopup></ng-container>
<ng-container #askQuestionPopup></ng-container>
<ng-container #faqSuccessPopup></ng-container>
<ng-container #productShare></ng-container>
<ng-container #addToCartToast></ng-container>
<ng-container #popupCrousel></ng-container>