<!--this will be injected into the instock or out of stock accrodingly-->
<ng-template #rfqFormTemplate>
    <form class="rfqForm" [formGroup]="rfqForm">
        <div class="product-rfq material-form" [class.in-instock]="!isOutOfStock">
            <div *ngIf="isOutOfStock" class="rfq_header">
                <i class="icon-dropbox-fill"></i>
                <div class="rfq_header_text">
                    <h3 [class.ins-text]="!isOutOfStock">
                        <ng-container *ngIf="isOutOfStock"> Available on Request. </ng-container>
                        Get Best Price
                    </h3>
                    <p>Add more details to get the best deal.</p>
                </div>
                <i (click)="isPopup = false; _commonService.oosSimilarCard$.next(false);"
                    class="icon-circle-delete del-ico"></i>
            </div>
            <div class="pwa-row rfq-container">
                <div class="pwa col-12">
                    <div class="req-qty">
                        <label>Enter the required quantity</label>
                        <!--As per Yajya-->
                        <div class="qty_section">
                            <div class="quantity-block">
                                <span class="add-qty qty-block" (click)="$event.stopPropagation();decreaseQuantity()">&#8722;</span>
                                <input type="text" formControlName="quantity" maxlength=3 (click)="isOutOfStock?initiateLogin():false"
                                    (keypress)="checkPinocdeKey($event)" numbersOnly>
                                <span class="remove-qty qty-block" (click)="$event.stopPropagation();increaseQuantity()">&#43;</span>
                                <ng-container *ngIf="isUserLoggedIn &&  isRFQSubmitted && (quantity.touched || quantity.dirty)">
                                    <p class="error-txt break-line" *ngIf="quantity.hasError('required')">Kindly enter valid
                                        quantity.</p>
                                    <p class="error-txt break-line" *ngIf="quantity.hasError('pattern')">
                                        Quantity should contain only digits.
                                    </p>
                                    <p class="error-txt break-line" *ngIf="quantity.hasError('min')">
                                        RFQ Quantity should be greater than {{productMOQ}}.</p>
                                </ng-container>
                            </div>
                        </div>
                        <!--Old Implementation:remove if above code works-->
                        <!-- <div class="quantity-block">
                            <button class="add-qty qty-btn"
                                (click)="$event.stopPropagation();decreaseQuantity()">&#8722;</button>
                            <input type="text" formControlName="quantity" maxlength=3
                                (click)="isOutOfStock?initiateLogin():false" (keypress)="checkPinocdeKey($event)">
                            <button class="remove-qty qty-btn"
                                (click)="$event.stopPropagation();increaseQuantity()">&#43;</button>
                            <ng-container *ngIf="isUserLoggedIn &&  isRFQSubmitted && (quantity.touched || quantity.dirty)">
                                <p class="error-txt break-line" *ngIf="quantity.hasError('required')">Kindly enter valid
                                    quantity.</p>
                                <p class="error-txt break-line" *ngIf="quantity.hasError('pattern')">
                                    Quantity should contain only digits.
                                </p>
                                <p class="error-txt break-line" *ngIf="quantity.hasError('min')">
                                    RFQ Quantity should be greater than {{productMOQ}}.</p>
                            </ng-container>
                        </div> -->
                    </div>
                    <div class="outline-input-label">
                        <label [class.is-focus]="firstName.value.length > 0">
                            <input type="text"  class="user-name" formControlName="firstName"
                                maxlength="30"  (click)="isOutOfStock?initiateLogin():false"
                                name="firstName" #firstName>
                            <ng-container *ngIf="isUserLoggedIn &&  isRFQSubmitted && (firstName.touched || firstName.dirty)">
                                <p class="error-txt" *ngIf="firstName.hasError('required')">Kindly enter your full name.</p>
                                <p class="error-txt" *ngIf="firstName.hasError('pattern')">Special characters are not allowed.
                                </p>
                            </ng-container>
                            <span class="label">Full Name*</span>
                        </label>
                    </div>
                    <div class="multiple-form-field">
                        <div class="outline-input-label">
                            <label [class.is-focus]="mobile.value.length > 0">
                                <input type="text" name="phone-no"  type="text" formControlName="mobile"
                                    maxlength="10" (click)="isOutOfStock?initiateLogin():false" #mobile>
                                <ng-container *ngIf="isUserLoggedIn &&  isRFQSubmitted && (mobile.touched || mobile.dirty)">
                                    <p class="error-txt" *ngIf="mobile.hasError('required')">Kindly enter your mobile no.</p>
                                    <p class="error-txt" *ngIf="mobile.hasError('pattern')">Mobile should contain only digits.
                                    </p>
                                    <p class="error-txt" *ngIf="!mobile.hasError('pattern') && mobile.hasError('minlength')">
                                        Mobile should contain 10 digits.</p>
                                </ng-container>
                                <span class="label">Mobile*</span>
                            </label>
                        </div>
                        <div class="outline-input-label">
                            <label [class.is-focus]="email.value.length > 0">
                                <input type="email" name="email" formControlName="email"  maxlength="150"
                                    (click)="isOutOfStock?initiateLogin():false" #email>
                                <ng-container *ngIf="isUserLoggedIn &&  isRFQSubmitted && (email.touched || email.dirty)">
                                    <p class="error-txt" *ngIf="email.hasError('required')">Kindly enter your email id.</p>
                                    <p class="error-txt" *ngIf="email.hasError('invalidEmail')">Kindly enter valid email id.
                                    </p>
                                </ng-container>
                                <span class="label">Email</span>
                            </label>
                        </div>
                    </div>
                    <div class="multiple-form-field">
                        <div class="outline-input-label">
                            <label [class.is-focus]="pincode.value.length > 0">
                                <input type="text" name="Pincode*" class="pincode" formControlName="pincode" maxlength="6"
                                    placeholder="" [readonly]="isPincodeUnKnown.value"
                                    (click)="isOutOfStock?initiateLogin():false" #pincode>
                                <ng-container *ngIf="isUserLoggedIn &&  isRFQSubmitted && (pincode.touched || pincode.dirty)">
                                    <!-- <p class="error-txt" *ngIf="pincode.hasError('required')">Kindly enter your pincode.</p> -->
                                    <p class="error-txt" *ngIf="pincode.hasError('pattern')">Pincode should contain only digits.
                                    </p>
                                    <p class="error-txt"
                                        *ngIf="pincode.hasError('minlength') && !(pincode.hasError('pattern'))">
                                        Pincode should contain 6 digits.
                                    </p>
                                </ng-container>
                                <p class="error-txt" *ngIf="isRFQSubmitted && pincode.valid && isInvalidPincode">
                                    Invalid pincode
                                </p>
                                <span class="label">Pincode</span>
                            </label>
                        </div>
                        <div class="outline-input-label">
                            <label [class.is-focus]="city.value.length > 0">
                                <input type="text" placeholder="" name="City*" formControlName="city" maxlength="30"
                                    [readonly]="!(isPincodeUnKnown.value)" (click)="isOutOfStock?initiateLogin():false"
                                    (paste)="$event.preventDefault()" #city>
                                <ng-container *ngIf="isUserLoggedIn &&  isRFQSubmitted && (pincode.touched ||  city.dirty)">
                                    <p class="error-txt" *ngIf="isPincodeUnKnown.value && city.hasError('required')">
                                        Kindly enter your city name.</p>
                                    <p class="error-txt" *ngIf="isPincodeUnKnown.value && city.hasError('pattern')">
                                        Kindly enter your valid city name.</p>
                                    <p class="error-txt"
                                        *ngIf="isPincodeUnKnown.value && city.hasError('maxlength') && !(city.hasError('pattern'))">
                                        City should contain 30 characters.
                                    </p>
                                </ng-container>
                                <span class="label">City</span>
                            </label>
                        </div>
                    </div>
                    <div class="rfq-checkbox">
                        <label>
                            <input type="checkbox" formControlName="isPincodeUnKnown"
                                (change)="$event.stopPropagation();handlePincodeCity()">
                            <span class="custom-box icon-box"></span>
                        </label>
                        <div class="chk-txt">
                            <span class="heading">I don't know my pincode</span>
                        </div>
                    </div>
                    <div class="outline-input-label ">
                        <label>
                            <textarea name="desc " placeholder="Mention details that you'd like to share..."
                                formControlName="description" maxlength="300"
                                (click)="isOutOfStock?initiateLogin():false"></textarea>
                            <ng-container
                                *ngIf="isUserLoggedIn &&  isRFQSubmitted && (description.touched || description.dirty)">
                                <p class="error-txt" *ngIf="description.hasError('pattern')">Description should contain only
                                    characters.</p>
                            </ng-container>
                        </label>
                    </div>
                    <div class="rfq-checkbox">
                        <label>
                            <input type="checkbox" formControlName="isBusinessCustomer"
                                (change)="$event.stopPropagation();handleBussinessCustomer()">
                            <span class="custom-box icon-box mar-t-5"></span>
                        </label>
                        <div class="chk-txt">
                            <span class="heading">Business Purchase</span>
                            <p class="txt" style="color:gray;">Add GSTIN for verification</p>
                        </div>
                    </div>
                    <div class="outline-input-label" *ngIf="isBusinessCustomer.value">
                        <label>
                            <input type="text" name="phone-no" formControlName="tin" maxlength="15" placeholder="Enter GSTIN*"
                                (click)="isOutOfStock?initiateLogin():false" (keyup)="$event.stopPropagation();gstinError=null">
                            <ng-container *ngIf="isUserLoggedIn &&  isRFQSubmitted && (tin.touched || tin.dirty)">
                                <p class="error-txt" *ngIf="tin.hasError('required')">Kindly enter GSTIN.</p>
                                <p class="error-txt" *ngIf="tin.hasError('pattern')">Kindly enter valid GSTIN.</p>
                            </ng-container>
                            <p class="error-txt" *ngIf="isRFQSubmitted && tin.errors ==null && gstinError">{{gstinError}}</p>
                        </label>
                    </div>
                    <div [class.fixed-bottom-cta]="isOutOfStock" [class.mt-60]="!isOutOfStock">
                        <button (click)="$event.stopPropagation();processRFQ(rfqForm.value)" class="btn primary-full-btn">SUBMIT YOUR REQUIREMENT</button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</ng-template>
<!--non-popup-->
<app-bottom-menu [isRFQPopUp]="true" *ngIf="isOutOfStock && isPopup" (outData$)="onUpdate($event)">
    <ng-container content *ngTemplateOutlet="rfqFormTemplate"></ng-container>
</app-bottom-menu>
<!--Popup-->
<app-pop-up *ngIf="!isOutOfStock && isPopup"
    [headerType]="'pop-up-header2'"
    [data]="{headerText: 'Interested to buy in bulk', headerSubText: 'Add more details to get the best deal'}">
    <div class="content-popup rfqPopup pwa-row" content>
        <div class="pwa-col-12">
            <ng-container *ngTemplateOutlet="rfqFormTemplate "></ng-container>
        </div>
    </div>
</app-pop-up>